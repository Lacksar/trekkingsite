<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nepal Adventures - Himalayan Peaks</title>
    <!-- Title will be updated by JS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      .hero-bg-dynamic {
        /* Placeholder, will be set by JS or default */
        background-image: url("https://images.pexels.com/photos/2356045/pexels-photo-2356045.jpeg?auto=compress&cs=tinysrgb&w=1920&h=1080&dpr=1");
        background-size: cover;
        background-position: center;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .fade-in-section {
        opacity: 0;
        animation: fadeIn 0.8s ease-out forwards;
      }
      .activity-card {
        /* Base style for cards */
        display: flex;
        flex-direction: column;
      }
      .activity-card .p-5 {
        /* Ensure text content area can grow */
        flex-grow: 1;
        display: flex;
        flex-direction: column;
      }
      .activity-card .description-area {
        /* For description paragraph */
        flex-grow: 1;
      }
      .activity-card .cta-area {
        /* For buttons or extra info */
        margin-top: auto; /* Pushes to the bottom */
      }
    </style>
  </head>
  <body class="bg-gray-100 text-gray-800 antialiased">
    <header
      id="page-hero"
      class="relative h-[40vh] md:h-[50vh] flex flex-col hero-bg-dynamic"
    >
      <nav class="absolute top-0 left-0 right-0 z-20 p-6">
        <div class="container mx-auto flex justify-between items-center">
          <a
            href="index.html"
            class="text-white text-3xl font-bold tracking-tight"
          >
            Himalayan<span class="text-yellow-400">Peaks</span>
          </a>
          <div class="hidden md:flex space-x-8">
            <a href="index.html#home" class="text-white hover:text-yellow-400"
              >Home</a
            >
            <a
              href="nepal-categories.html"
              class="text-white hover:text-yellow-400"
              >Categories</a
            >
            <a
              href="index.html#reviews"
              class="text-white hover:text-yellow-400"
              >Reviews</a
            >
            <a
              href="index.html#contact"
              class="text-white hover:text-yellow-400"
              >Contact</a
            >
          </div>
          <button
            id="mobile-menu-button"
            class="md:hidden text-white focus:outline-none"
          >
            <svg
              class="w-8 h-8"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16m-7 6h7"
              ></path>
            </svg>
          </button>
        </div>
      </nav>
      <div
        id="mobile-menu"
        class="hidden md:hidden absolute top-16 left-0 right-0 bg-black bg-opacity-90 z-10 p-4"
      >
        <a
          href="index.html#home"
          class="block text-white py-2 px-4 hover:bg-yellow-500 hover:text-black rounded"
          >Home</a
        >
        <a
          href="nepal-categories.html"
          class="block text-white py-2 px-4 hover:bg-yellow-500 hover:text-black rounded"
          >Categories</a
        >
        <a
          href="index.html#reviews"
          class="block text-white py-2 px-4 hover:bg-yellow-500 hover:text-black rounded"
          >Reviews</a
        >
        <a
          href="index.html#contact"
          class="block text-white py-2 px-4 hover:bg-yellow-500 hover:text-black rounded"
          >Contact</a
        >
      </div>

      <div class="absolute inset-0 bg-black bg-opacity-50"></div>
      <div
        class="relative z-10 flex-grow flex flex-col items-center justify-center text-center px-4"
      >
        <h1
          id="page-main-title"
          class="text-4xl md:text-6xl text-white font-extrabold mb-4 drop-shadow-lg fade-in-section"
        >
          Loading Adventures...
        </h1>
        <p
          id="page-subtitle"
          class="text-lg md:text-xl text-yellow-100 max-w-xl drop-shadow-md fade-in-section"
        ></p>
      </div>
    </header>

    <main class="py-12 md:py-16">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div id="activities-breadcrumb" class="mb-8 text-sm text-gray-600">
          <a href="index.html" class="hover:text-yellow-600">Home</a> »
          <a href="nepal-categories.html" class="hover:text-yellow-600"
            >Nepal Categories</a
          >
          »
          <span
            id="breadcrumb-current-category"
            class="font-semibold text-gray-800"
            >Current Category</span
          >
        </div>

        <div id="activities-grid-container">
          <p
            id="loading-activities-message"
            class="text-center text-gray-600 text-xl"
          >
            Fetching activities...
          </p>
          <!-- Adjusted grid for larger cards -->
          <div
            id="activities-grid"
            class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-8 md:gap-10"
          >
            <!-- Activity cards will be dynamically injected here -->
          </div>
        </div>
        <div
          id="no-activities-message"
          class="hidden text-center text-gray-600 text-xl py-10"
        >
          <i class="fas fa-search fa-3x mb-4 text-gray-400"></i>
          <p>
            No activities found for this category, or the category is invalid.
          </p>
          <a
            href="nepal-categories.html"
            class="mt-4 inline-block bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-semibold py-2 px-6 rounded-lg"
          >
            Back to Categories
          </a>
        </div>
      </div>
    </main>

    <!-- Reused Footer Section -->
    <footer class="bg-gray-900 text-gray-400 py-16">
      <div class="container mx-auto px-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-10">
          <div>
            <h4 class="text-xl font-semibold text-white mb-4">
              Himalayan<span class="text-yellow-400">Peaks</span>
            </h4>
            <p class="text-sm mb-4 leading-relaxed">
              Your trusted partner for extraordinary adventures.
            </p>
            <div class="flex space-x-4">
              <a href="#" class="text-gray-400 hover:text-yellow-400"
                ><i class="fab fa-facebook-f fa-lg"></i
              ></a>
              <a href="#" class="text-gray-400 hover:text-yellow-400"
                ><i class="fab fa-instagram fa-lg"></i
              ></a>
              <a href="#" class="text-gray-400 hover:text-yellow-400"
                ><i class="fab fa-twitter fa-lg"></i
              ></a>
            </div>
          </div>
          <div>
            <h4 class="text-lg font-semibold text-white mb-4">Explore</h4>
            <ul class="space-y-2 text-sm">
              <li>
                <a href="index.html#home" class="hover:text-yellow-400">Home</a>
              </li>
              <li>
                <a href="nepal-categories.html" class="hover:text-yellow-400"
                  >All Categories</a
                >
              </li>
              <li><a href="#" class="hover:text-yellow-400">About Us</a></li>
              <li><a href="#" class="hover:text-yellow-400">Blog</a></li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold text-white mb-4">Legal</h4>
            <ul class="space-y-2 text-sm">
              <li>
                <a href="#" class="hover:text-yellow-400">Terms & Conditions</a>
              </li>
              <li>
                <a href="#" class="hover:text-yellow-400">Privacy Policy</a>
              </li>
              <li><a href="#" class="hover:text-yellow-400">FAQ</a></li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold text-white mb-4">Contact Us</h4>
            <address class="text-sm not-italic space-y-2">
              <p>
                <i class="fas fa-map-marker-alt mr-2 text-yellow-400"></i
                >Kathmandu, Nepal
              </p>
              <p>
                <i class="fas fa-phone mr-2 text-yellow-400"></i>+977 12345678
              </p>
              <p>
                <i class="fas fa-envelope mr-2 text-yellow-400"></i
                >info@himalayanpeaks.com
              </p>
            </address>
          </div>
        </div>
        <div class="mt-12 pt-8 border-t border-gray-700 text-center">
          <p class="text-sm">
            © <span id="currentYear"></span> HimalayanPeaks. All rights
            reserved.
          </p>
        </div>
      </div>
    </footer>

    <script>
      // Mobile menu toggle
      const mobileMenuButton = document.getElementById("mobile-menu-button");
      const mobileMenu = document.getElementById("mobile-menu");
      if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener("click", () =>
          mobileMenu.classList.toggle("hidden")
        );
        mobileMenu.querySelectorAll("a").forEach((link) => {
          link.addEventListener("click", () =>
            mobileMenu.classList.add("hidden")
          );
        });
      }
      document.getElementById("currentYear").textContent =
        new Date().getFullYear();

      // Hero images for categories
      const categoryHeroImages = {
        trekking_trips:
          "https://images.pexels.com/photos/1271619/pexels-photo-1271619.jpeg?auto=compress&cs=tinysrgb&w=1920&h=1080&dpr=1", // Trekking specific
        package_tours:
          "https://images.pexels.com/photos/3889742/pexels-photo-3889742.jpeg?auto=compress&cs=tinysrgb&w=1920&h=1080&dpr=1", // Tours specific
        peak_climbing:
          "https://images.pexels.com/photos/618833/pexels-photo-618833.jpeg?auto=compress&cs=tinysrgb&w=1920&h=1080&dpr=1", // Climbing specific
        nepal_expeditions:
          "https://images.pexels.com/photos/112285/pexels-photo-112285.jpeg?auto=compress&cs=tinysrgb&w=1920&h=1080&dpr=1", // Expeditions specific
        nepal_rafting:
          "https://images.pexels.com/photos/1655650/pexels-photo-1655650.jpeg?auto=compress&cs=tinysrgb&w=1920&h=1080&dpr=1", // Rafting specific
        chitwan_jungle_safari:
          "https://images.pexels.com/photos/130879/pexels-photo-130879.jpeg?auto=compress&cs=tinysrgb&w=1920&h=1080&dpr=1", // Safari specific
        nepal_paragliding:
          "https://images.pexels.com/photos/2325446/pexels-photo-2325446.jpeg?auto=compress&cs=tinysrgb&w=1920&h=1080&dpr=1", // Paragliding specific
        bunzy_jump_in_nepal:
          "https://images.pexels.com/photos/2257775/pexels-photo-2257775.jpeg?auto=compress&cs=tinysrgb&w=1920&h=1080&dpr=1", // Bungee specific
        mountain_flight_in_nepal:
          "https://images.pexels.com/photos/3732653/pexels-photo-3732653.jpeg?auto=compress&cs=tinysrgb&w=1920&h=1080&dpr=1", // Mountain flight specific
        default:
          "https://images.pexels.com/photos/2356045/pexels-photo-2356045.jpeg?auto=compress&cs=tinysrgb&w=1920&h=1080&dpr=1",
      };

      function formatCategoryTitle(key) {
        if (!key) return "Adventures";
        return key
          .replace(/_/g, " ")
          .replace(/\b\w/g, (char) => char.toUpperCase());
      }

      // Updated createActivityCard function
      function createActivityCard(item, currentCategoryKey) {
        // currentCategoryKey is the main category key like "trekking_trips"
        const placeholderImageOnError =
          "https://images.pexels.com/photos/147411/italy-mountains-dawn-daybreak-147411.jpeg?auto=compress&cs=tinysrgb&w=600&lazy=load";

        let imageUrl =
          item.image_url ||
          (currentCategoryKey && categoryHeroImages[currentCategoryKey]) ||
          placeholderImageOnError;
        // Validate image URL format roughly
        if (
          imageUrl !== placeholderImageOnError &&
          !(
            imageUrl.includes(".jpg") ||
            imageUrl.includes(".jpeg") ||
            imageUrl.includes(".png") ||
            imageUrl.includes("images.pexels.com") ||
            imageUrl.includes("media.gettyimages.com") ||
            imageUrl.includes("pixabay.com") ||
            imageUrl.includes("mountainrocktreks.com") ||
            imageUrl.includes("halfwayanywhere.com") ||
            imageUrl.includes("istockphoto.com") ||
            imageUrl.includes("shutterstock.com") ||
            imageUrl.includes("tripadvisor.com") ||
            imageUrl.includes("instagram.com") ||
            imageUrl.includes("gettyimages.com") ||
            imageUrl.includes("culturalsafaritours.com")
          )
        ) {
          imageUrl = placeholderImageOnError; // Fallback if format seems off
        }

        let activityLink;
        let callToActionContent = "";
        const title = item.title || "N/A";

        if (item.available_treks && item.available_treks.length > 0) {
          // This item is a region with sub-treks (like "Everest Region Trekking")
          // Link to trek-listing.html, passing the main category key and this specific region's title.
          activityLink = `trek-listing.html?category=${encodeURIComponent(
            currentCategoryKey
          )}&regionTitle=${encodeURIComponent(title)}`;
        } else {
          // This is a direct activity (like "Kathmandu Chitwan Tour" or a single-item category)
          // The link can go to a specific detail page for this item (placeholder for now).
          activityLink = `#activity-${title
            .toLowerCase()
            .replace(/\s+/g, "-")}`;

          // Display details like duration, altitude, price for these non-expandable items
          let detailsHtml = "";
          if (item.duration)
            detailsHtml += `<div><i class="fas fa-clock mr-1 text-yellow-500"></i> ${item.duration}</div>`;
          if (item.altitude)
            detailsHtml += `<div><i class="fas fa-mountain mr-1 text-yellow-500"></i> Max Alt: ${item.altitude}</div>`;
          if (item.price)
            detailsHtml += `<div><i class="fas fa-dollar-sign mr-1 text-yellow-500"></i> Price: ${item.price}</div>`;

          if (detailsHtml) {
            callToActionContent = `<div class="mt-3 pt-3 border-t border-gray-200 text-xs text-gray-500 space-y-1 text-left px-2">${detailsHtml}</div>`;
          } else {
            callToActionContent = `<span class="inline-block bg-blue-500 hover:bg-blue-600 text-white text-sm font-semibold px-4 py-2 rounded-md transition-colors">View Details <i class="fas fa-info-circle ml-1"></i></span>`;
          }
        }

        const description = item.description
          ? `<p class="text-sm text-gray-600 mb-3 description-area">${item.description.substring(
              0,
              100
            )}${item.description.length > 100 ? "..." : ""}</p>`
          : '<div class="description-area"></div>';

        return `
                <div class="activity-card bg-white rounded-xl shadow-lg overflow-hidden group transform transition-all duration-300 ease-out hover:shadow-2xl hover:-translate-y-1.5">
                    <a href="${activityLink}" class="block">
                        <div class="relative h-60 md:h-64 overflow-hidden">
                            <img src="${imageUrl}" alt="${title}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" loading="lazy" onerror="this.onerror=null;this.src='${placeholderImageOnError}';">
                        </div>
                    </a>
                    <div class="p-5 text-center">
                        <h3 class="text-xl font-semibold text-gray-800 group-hover:text-yellow-600 transition-colors mb-2">
                            <a href="${activityLink}" class="hover:underline">${title}</a>
                        </h3>
                        ${description}
                        <div class="cta-area">
                           ${callToActionContent}
                        </div>
                    </div>
                </div>
            `;
      }

      document.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const categoryKey = urlParams.get("category"); // This is the key from data.json (e.g., "trekking_trips")

        const pageHero = document.getElementById("page-hero");
        const pageMainTitle = document.getElementById("page-main-title");
        const pageSubtitle = document.getElementById("page-subtitle");
        const breadcrumbCurrentCategory = document.getElementById(
          "breadcrumb-current-category"
        );

        const activitiesGrid = document.getElementById("activities-grid");
        const loadingMessage = document.getElementById(
          "loading-activities-message"
        );
        const noActivitiesMessage = document.getElementById(
          "no-activities-message"
        );
        const activitiesGridContainer = document.getElementById(
          "activities-grid-container"
        );

        const formattedCategoryTitle = formatCategoryTitle(categoryKey);
        document.title = `${formattedCategoryTitle} - Himalayan Peaks`;
        pageMainTitle.textContent = formattedCategoryTitle;
        pageSubtitle.textContent = `Discover amazing ${formattedCategoryTitle.toLowerCase()} options in the heart of the Himalayas.`;
        breadcrumbCurrentCategory.textContent = formattedCategoryTitle;

        const heroImageUrl =
          categoryHeroImages[categoryKey] || categoryHeroImages["default"];
        if (pageHero) {
          pageHero.style.backgroundImage = `url('${heroImageUrl}')`;
        }

        if (!categoryKey) {
          pageMainTitle.textContent = "Category Not Specified";
          if (loadingMessage) loadingMessage.style.display = "none";
          if (activitiesGridContainer)
            activitiesGridContainer.style.display = "none";
          if (noActivitiesMessage) {
            noActivitiesMessage.classList.remove("hidden");
            noActivitiesMessage.querySelector("p").textContent =
              "No category was specified. Please go back and select one.";
          }
          return;
        }

        fetch("data.json")
          .then((response) => {
            if (!response.ok)
              throw new Error(`HTTP error! status: ${response.status}`);
            return response.json();
          })
          .then((data) => {
            if (loadingMessage) loadingMessage.style.display = "none";

            const categoryData = data.find((obj) =>
              obj.hasOwnProperty(categoryKey)
            );
            let itemsToDisplay = [];

            if (categoryData) {
              if (Array.isArray(categoryData[categoryKey])) {
                // e.g. trekking_trips, package_tours are arrays
                itemsToDisplay = categoryData[categoryKey];
              } else if (
                typeof categoryData[categoryKey] === "object" &&
                categoryData[categoryKey] !== null
              ) {
                // Handles single object categories like chitwan_jungle_safari
                itemsToDisplay = [categoryData[categoryKey]]; // Wrap in an array to use forEach
              }
            }

            if (itemsToDisplay.length > 0) {
              let activitiesHtml = "";
              itemsToDisplay.forEach((item) => {
                activitiesHtml += createActivityCard(item, categoryKey); // Pass categoryKey here
              });
              activitiesGrid.innerHTML = activitiesHtml;
              if (noActivitiesMessage)
                noActivitiesMessage.classList.add("hidden");
              if (activitiesGridContainer)
                activitiesGridContainer.classList.remove("hidden");

              const animatedCards =
                activitiesGrid.querySelectorAll(".activity-card");
              animatedCards.forEach((card, index) => {
                card.style.opacity = "0";
                card.style.transform = "translateY(20px)";
                card.style.transition = `opacity 0.5s ease-out ${
                  index * 0.07
                }s, transform 0.5s ease-out ${index * 0.07}s`;
                const observer = new IntersectionObserver(
                  (entries) => {
                    entries.forEach((entry) => {
                      if (entry.isIntersecting) {
                        entry.target.style.opacity = "1";
                        entry.target.style.transform = "translateY(0)";
                        observer.unobserve(entry.target);
                      }
                    });
                  },
                  { threshold: 0.1 }
                );
                observer.observe(card);
              });
            } else {
              if (activitiesGridContainer)
                activitiesGridContainer.style.display = "none";
              if (noActivitiesMessage)
                noActivitiesMessage.classList.remove("hidden");
            }
          })
          .catch((error) => {
            console.error("Error fetching or processing data:", error);
            if (loadingMessage) loadingMessage.style.display = "none";
            if (activitiesGridContainer)
              activitiesGridContainer.style.display = "none";
            if (noActivitiesMessage) {
              noActivitiesMessage.classList.remove("hidden");
              noActivitiesMessage.querySelector(
                "p"
              ).innerHTML = `Could not load activities. Please try again later. <br><small>${error.message}</small>`;
            }
          });
      });
    </script>
  </body>
</html>
